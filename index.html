<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<title>Eisenhower Matrix</title>
<style>
/* EXISTING STYLES (keep all your current styles) */

/* ADD THIS FIX FOR MODALS */
.modal {
  position: fixed !important;
  display: none !important;
  align-items: center !important;
  justify-content: center !important;
  z-index: 9999 !important;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.modal.show {
  display: flex !important;
  opacity: 1;
}

/* Ensure modal content is above everything */
.modal-content {
  z-index: 10000 !important;
  position: relative !important;
  transform: scale(0.9);
  transition: transform 0.3s ease;
}

.modal.show .modal-content {
  transform: scale(1);
}

/* Force buttons to work */
button {
  cursor: pointer !important;
  position: relative !important;
  z-index: 1 !important;
}

/* Fix for GitHub Pages overlay */
body.modal-open {
  overflow: hidden;
}

/* Add backdrop filter for modern browsers */
.modal::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(2px);
  z-index: -1;
}
</style>
</head>
<body>

<div class="header">
  <h1>Eisenhower Matrix</h1>
  <div class="sync-container">
    <span class="sync-status" id="syncStatus">Offline</span>
    <div style="position: relative;">
      <button class="google-drive-btn" id="googleDriveBtn">
        <span>G</span>
        <span id="driveBtnText">Sync with Drive</span>
      </button>
      <div class="sync-options" id="syncOptions">
        <div style="margin-bottom: 10px; font-weight: bold;">Google Drive Sync</div>
        <button id="signInBtn">Sign in with Google</button>
        <button id="signOutBtn" style="display: none;">Sign out</button>
        <hr>
        <button id="syncNowBtn">Sync Now</button>
        <button id="loadFromDriveBtn">Load from Drive</button>
      </div>
    </div>
    <div class="user-info" id="userInfo" style="display: none;">
      <img id="userAvatar" class="user-avatar" src="" alt="">
      <span id="userName"></span>
    </div>
    <button class="clear-data-btn" id="clearAllBtn">Clear All</button>
    <button class="add-btn secondary" id="addGroupBtn">+ Add Group</button>
    <button class="add-btn" id="addTaskBtn">+ Add Task</button>
  </div>
</div>

<div class="matrix">
  <div class="quadrant q1" id="q1"><h2>Important & Urgent</h2></div>
  <div class="quadrant q2" id="q2"><h2>Important & Not Urgent</h2></div>
  <div class="quadrant q3" id="q3"><h2>Not Important & Urgent</h2></div>
  <div class="quadrant q4" id="q4"><h2>Not Important & Not Urgent</h2></div>
</div>

<div class="modal" id="taskModal">
  <div class="modal-content">
    <h3>Add / Edit Task</h3>
    <label>Task name <input id="taskName" style="width:100%"></label>
    <label><input type="checkbox" id="important"> Important</label>
    <label><input type="checkbox" id="urgent"> Urgent</label>
    <label>Group
      <select id="taskGroup" style="width:100%">
        <option value="">No Group</option>
      </select>
    </label>
    <div class="modal-actions">
      <button id="cancelTaskBtn">Cancel</button>
      <button id="saveTaskBtn">Save</button>
    </div>
  </div>
</div>

<div class="modal" id="groupModal">
  <div class="modal-content">
    <h3 id="groupModalTitle">Add Group</h3>
    <label>Group name <input id="groupName" style="width:100%"></label>
    <label>Group color <input type="color" id="groupColor"></label>
    <div class="modal-actions">
      <button id="cancelGroupBtn">Cancel</button>
      <button id="saveGroupBtn">Add</button>
    </div>
  </div>
</div>

<!-- Your existing delete modal stays the same -->

<script>
// ============================================
// EVENT LISTENER SETUP (FIX FOR GITHUB PAGES)
// ============================================

document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded - setting up event listeners');
  
  // Set up button event listeners
  document.getElementById('addTaskBtn').addEventListener('click', function() {
    console.log('Add Task clicked');
    showModal('taskModal');
  });
  
  document.getElementById('addGroupBtn').addEventListener('click', function() {
    console.log('Add Group clicked');
    showModal('groupModal');
  });
  
  document.getElementById('cancelTaskBtn').addEventListener('click', function() {
    hideModal('taskModal');
  });
  
  document.getElementById('cancelGroupBtn').addEventListener('click', function() {
    hideModal('groupModal');
  });
  
  document.getElementById('saveTaskBtn').addEventListener('click', saveTask);
  document.getElementById('saveGroupBtn').addEventListener('click', saveGroup);
  document.getElementById('clearAllBtn').addEventListener('click', clearAllData);
  
  // Google Drive buttons
  document.getElementById('googleDriveBtn').addEventListener('click', toggleSyncOptions);
  document.getElementById('signInBtn').addEventListener('click', signInWithGoogle);
  document.getElementById('signOutBtn').addEventListener('click', signOutFromGoogle);
  document.getElementById('syncNowBtn').addEventListener('click', forceSyncToDrive);
  document.getElementById('loadFromDriveBtn').addEventListener('click', loadFromDrive);
  
  // Close modals when clicking outside
  document.addEventListener('click', function(event) {
    if (event.target.classList.contains('modal')) {
      hideModal(event.target.id);
    }
  });
  
  // Escape key to close modals
  document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
      hideModal('taskModal');
      hideModal('groupModal');
      hideModal('deleteGroupModal');
    }
  });
  
  console.log('Event listeners setup complete');
});

// ============================================
// MODAL FUNCTIONS (FIXED)
// ============================================

function showModal(modalId) {
  console.log('Showing modal:', modalId);
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.classList.add('show');
    document.body.classList.add('modal-open');
    console.log('Modal shown successfully');
  } else {
    console.error('Modal not found:', modalId);
  }
}

function hideModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.classList.remove('show');
    document.body.classList.remove('modal-open');
  }
}

function openTaskModal(task = null) {
  editingTask = task;
  showModal('taskModal');
  
  if (!task) {
    document.getElementById('taskName').value = '';
    document.getElementById('important').checked = false;
    document.getElementById('urgent').checked = false;
    document.getElementById('taskGroup').value = '';
    return;
  }
  
  document.getElementById('taskName').value = task.dataset.name;
  document.getElementById('important').checked = task.dataset.important === 'true';
  document.getElementById('urgent').checked = task.dataset.urgent === 'true';
  document.getElementById('taskGroup').value = task.dataset.group || '';
}

function closeTaskModal() {
  editingTask = null;
  hideModal('taskModal');
}

function openGroupModal() {
  editingGroup = null;
  document.getElementById('groupModalTitle').textContent = 'Add Group';
  document.getElementById('groupName').value = '';
  document.getElementById('groupColor').value = '#1976d2';
  document.getElementById('saveGroupBtn').textContent = 'Add';
  showModal('groupModal');
}

function closeGroupModal() {
  editingGroup = null;
  hideModal('groupModal');
}

// ============================================
// TASK FUNCTIONS (KEEP YOUR EXISTING LOGIC)
// ============================================

function saveTask() {
  // Your existing saveTask function
  const taskNameEl = document.getElementById('taskName');
  const importantEl = document.getElementById('important');
  const urgentEl = document.getElementById('urgent');
  const taskGroupEl = document.getElementById('taskGroup');

  const name = taskNameEl.value.trim();
  if (!name) return;

  const isImportant = importantEl.checked;
  const isUrgent = urgentEl.checked;
  const group = taskGroupEl.value;

  const quadrantId = isImportant && isUrgent
    ? 'q1'
    : isImportant
    ? 'q2'
    : isUrgent
    ? 'q3'
    : 'q4';

  const quadrant = document.getElementById(quadrantId);

  const task = editingTask || document.createElement('div');
  task.className = 'task';
  task.draggable = true;
  task.dataset.name = name;
  task.dataset.important = isImportant;
  task.dataset.urgent = isUrgent;
  task.dataset.group = group;

  task.innerHTML = `
    <div class="task-left">
      ${group && groups[group] ? `<span class="group-dot" style="background:${groups[group]}"></span>` : ''}
      <span>${name}</span>
    </div>
    <div class="task-menu">
      <span class="dots">â‹®</span>
      <div class="menu">
        <div class="edit-task-btn">Edit</div>
        <div class="delete-task-btn">Delete</div>
      </div>
    </div>`;

  // Add event listeners for the new buttons
  task.querySelector('.edit-task-btn').addEventListener('click', function() {
    openTaskModal(task);
  });
  
  task.querySelector('.delete-task-btn').addEventListener('click', function() {
    deleteTask(task);
  });

  task.addEventListener('dragstart', (e) => {
    e.stopPropagation();
    task.classList.add('dragging');
  });
  
  task.addEventListener('dragend', () => {
    task.classList.remove('dragging');
  });

  if (group && groups[group]) {
    let groupContainer = Array.from(quadrant.querySelectorAll('.group-container'))
      .find(g => g.dataset.name === group);
    if (!groupContainer) {
      groupContainer = createGroupContainer(group, quadrant);
    }
    groupContainer.querySelector('.group-tasks').appendChild(task);
  } else {
    quadrant.appendChild(task);
  }

  saveToLocalStorage();
  closeTaskModal();
}

// ============================================
// DRAG AND DROP SETUP
// ============================================

document.querySelectorAll('.quadrant').forEach(q => {
  q.addEventListener('dragover', e => e.preventDefault());
  q.addEventListener('drop', function(e) {
    e.preventDefault();
    const draggedElement = document.querySelector('.dragging');
    if (!draggedElement) return;
    
    const targetQuadrant = e.currentTarget;
    
    // Your existing drop logic
    // ... (copy your existing drop event handler here)
    
    saveToLocalStorage();
  });
});

// ============================================
// INITIALIZATION
// ============================================

// Your existing initialization code
// Make sure it runs AFTER DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  // Load from localStorage
  const savedData = localStorage.getItem('eisenhowerMatrixData');
  if (savedData) {
    try {
      loadData(JSON.parse(savedData));
    } catch (e) {
      console.error('Error loading data:', e);
    }
  }
  
  // Initialize groups dropdown
  updateGroupsDropdown();
});

function updateGroupsDropdown() {
  const select = document.getElementById('taskGroup');
  select.innerHTML = '<option value="">No Group</option>';
  Object.keys(groups).forEach(name => {
    const opt = document.createElement('option');
    opt.value = name;
    opt.textContent = name;
    select.appendChild(opt);
  });
}

// ============================================
// UTILITY FUNCTIONS
// ============================================

// Your existing utility functions
let groups = {};
let editingTask = null;
let editingGroup = null;
let deletingGroup = null;

function saveToLocalStorage() {
  const data = getCurrentMatrixData();
  localStorage.setItem('eisenhowerMatrixData', JSON.stringify(data));
}

function getCurrentMatrixData() {
  const tasks = [];
  document.querySelectorAll('.task').forEach(task => {
    tasks.push({
      name: task.dataset.name,
      important: task.dataset.important === 'true',
      urgent: task.dataset.urgent === 'true',
      group: task.dataset.group || '',
      quadrant: getTaskQuadrant(task)
    });
  });
  
  return {
    version: '1.0',
    timestamp: new Date().toISOString(),
    groups: { ...groups },
    tasks: tasks
  };
}

function getTaskQuadrant(task) {
  const quadrant = task.closest('.quadrant');
  return quadrant ? quadrant.id : '';
}

// ... rest of your existing functions
</script>
</body>
</html>
